<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VIP Probability Predictor</title>
  <!-- TensorFlow.js (loaded from CDN so the file works by simply opening it) -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.18.0/dist/tf.min.js"></script>
  <style>
    :root{
      --bg: #0b1020;
      --panel: #121a33;
      --accent: #6ee7ff;
      --text: #e8eefc;
      --muted: #9fb1d1;
      --danger: #ff5577;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body{
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 20% -10%, #18224a 0%, var(--bg) 55%);
      color: var(--text);
      display: grid;
      place-items: center;
      padding: 24px;
    }
    .card{
      width: min(720px, 100%);
      background: linear-gradient(160deg, rgba(255,255,255,0.04), rgba(255,255,255,0.01));
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: 0 20px 50px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.05);
      border-radius: 18px;
      padding: 22px 22px 18px;
      backdrop-filter: blur(6px);
    }
    .header{
      display: flex; align-items: center; gap: 12px; margin-bottom: 8px;
    }
    .logo{
      width: 42px; height: 42px; border-radius: 12px; display: grid; place-items: center; background: #0f1733; border: 1px solid rgba(255,255,255,0.08);
      box-shadow: inset 0 0 18px rgba(110,231,255,0.2);
    }
    .logo svg{ width: 26px; height: 26px; fill: var(--accent); }
    h1{ font-size: 1.35rem; margin: 0; letter-spacing: 0.2px; }
    p.sub{ margin: 4px 0 16px; color: var(--muted); }
    .grid{
      display: grid; gap: 14px; grid-template-columns: 1fr; margin-top: 8px;
    }
    @media (min-width: 680px){ .grid{ grid-template-columns: 1fr 1fr; } }
    .field{
      display: grid; gap: 8px; background: var(--panel); border: 1px solid rgba(255,255,255,0.06); border-radius: 14px; padding: 14px;
    }
    label{ font-weight: 600; font-size: 0.95rem; }
    .hint{ color: var(--muted); font-size: 0.85rem; }
    input[type="number"]{
      width: 100%; padding: 12px 12px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.12); background: #0d142b; color: var(--text);
      font-size: 1rem; outline: none; transition: border-color .15s ease;
    }
    input[type="number"]:focus{ border-color: var(--accent); box-shadow: 0 0 0 3px rgba(110,231,255,0.12); }
    .actions{ display: flex; gap: 12px; margin-top: 16px; align-items: center; }
    button{
      appearance: none; border: none; cursor: pointer; padding: 12px 18px; border-radius: 12px; font-weight: 700; font-size: 1rem; letter-spacing: .2px;
      background: linear-gradient(180deg, #95f0ff, #38bdf8); color: #00121a; box-shadow: 0 10px 25px rgba(56,189,248,.35);
      transition: transform .06s ease, filter .15s ease, box-shadow .06s ease;
    }
    button:hover{ filter: brightness(1.05); }
    button:active{ transform: translateY(1px); box-shadow: 0 6px 16px rgba(56,189,248,.35); }
    .out{
      margin-top: 10px; font-size: 1.05rem; background: #0e1734; border: 1px dashed rgba(255,255,255,0.16); padding: 14px; border-radius: 12px;
    }
    .pill{ display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.1); background:#0b1430; color:var(--muted); font-size:.85rem }
    .barWrap{ height: 12px; background: #0b1430; border-radius: 999px; border:1px solid rgba(255,255,255,.1); overflow: hidden; }
    .bar{ height: 100%; width: 0%; background: linear-gradient(90deg, #22d3ee, #38bdf8 50%, #60a5fa); transition: width .25s ease; }
    .foot{ margin-top: 10px; color: var(--muted); font-size: 0.85rem; line-height: 1.4; }
    .err{ color: var(--danger); font-weight: 600; }
    .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
  </style>
</head>
<body>
  <main class="card" role="main">
    <div class="header">
      <div class="logo" aria-hidden="true">
        <svg viewBox="0 0 24 24" role="img" aria-label="Star icon"><path d="M12 2l2.39 6.96H22l-5.7 4.14 2.18 6.9L12 16.91 5.52 20l2.18-6.9L2 8.96h7.61z"/></svg>
      </div>
      <div>
        <h1>VIP Probability Predictor</h1>
        <p class="sub">Neural network (TensorFlow.js) scoring based on two signals: average monthly visits and average purchase amount.</p>
      </div>
    </div>

    <div class="grid" aria-describedby="normnote">
      <div class="field">
        <label for="visits">Average Monthly Visits</label>
        <input id="visits" type="number" inputmode="numeric" placeholder="e.g. 8" min="0" step="1" />
        <div class="hint">Typical range: 0 – 30 visits/month.</div>
      </div>
      <div class="field">
        <label for="amount">Average Purchase Amount</label>
        <input id="amount" type="number" inputmode="decimal" placeholder="e.g. 120.00" min="0" step="0.01" />
        <div class="hint">Typical range: 0 – 500 (your currency).</div>
      </div>
    </div>

    <div class="actions">
      <button id="predictBtn" type="button">Predict</button>
      <span class="pill" id="modelPill">Model: 2→1 (sigmoid)</span>
    </div>

    <div class="out" aria-live="polite" aria-atomic="true">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap">
        <strong id="resultText">VIP Probability: —</strong>
        <span id="errorText" class="err" style="display:none"></span>
      </div>
      <div class="barWrap" aria-hidden="true" title="Probability meter" style="margin-top:10px">
        <div class="bar" id="probBar"></div>
      </div>
    </div>

    <p class="foot" id="normnote">
      <strong>How it works:</strong> Inputs are normalized (visits ÷ <code>VISITS_MAX</code>, amount ÷ <code>AMOUNT_MAX</code>). A tiny neural net (sigmoid neuron) scores the customer. The weights are seeded to emphasize purchase amount slightly more than visit frequency. Adjust the constants in the script to match your business ranges.
    </p>
  </main>

  <script>
    // === Configuration: adjust these to your data distribution ===
    const VISITS_MAX = 30;   // assumed "high" monthly visits
    const AMOUNT_MAX = 500;  // assumed "high" average purchase amount (your currency)

    // === Build a tiny TensorFlow.js model (2 inputs -> 1 sigmoid output) ===
    // We set deterministic weights so there's no training step and the page works offline.
    const model = tf.sequential();
    model.add(tf.layers.dense({ units: 1, inputShape: [2], activation: 'sigmoid', useBias: true }));

    // Kernel weights (2x1) and bias (1). Tuned so amount has slightly higher influence than visits.
    const kernel = tf.tensor2d([[0.8],   // weight for visits
                                [1.2]]); // weight for amount
    const bias   = tf.tensor1d([-1.5]);  // shifts base probability downward
    model.layers[0].setWeights([kernel, bias]);

    // Utility: clamp and normalize
    function normalize(value, max){
      const v = Number(value);
      if (!isFinite(v) || v < 0) return null;
      return Math.min(v / max, 1);
    }

    function formatProb(p){
      // Keep within [0,1] and show 2 decimals
      const clamped = Math.max(0, Math.min(1, Number(p)));
      return clamped.toFixed(2);
    }

    async function predict(){
      const visitsEl = document.getElementById('visits');
      const amountEl = document.getElementById('amount');
      const outEl = document.getElementById('resultText');
      const errEl = document.getElementById('errorText');
      const barEl = document.getElementById('probBar');

      errEl.style.display = 'none';
      errEl.textContent = '';

      const nVisits = normalize(visitsEl.value, VISITS_MAX);
      const nAmount = normalize(amountEl.value, AMOUNT_MAX);

      if (nVisits === null || nAmount === null){
        errEl.textContent = 'Please enter non-negative numbers for both fields.';
        errEl.style.display = 'inline';
        outEl.textContent = 'VIP Probability: —';
        barEl.style.width = '0%';
        return;
      }

      // Predict with TensorFlow.js
      const prob = tf.tidy(() => {
        const input = tf.tensor2d([[nVisits, nAmount]]); // shape [1, 2]
        const output = model.predict(input);             // Tensor [1, 1]
        return output.dataSync()[0];                     // read scalar
      });

      const pretty = formatProb(prob);
      outEl.textContent = `VIP Probability: ${pretty}`;
      barEl.style.width = `${Math.round(Number(pretty) * 100)}%`;
    }

    // Wire up UI
    document.getElementById('predictBtn').addEventListener('click', predict);
    // Enter key triggers predict from either input
    ['visits','amount'].forEach(id => {
      document.getElementById(id).addEventListener('keydown', (e) => {
        if (e.key === 'Enter') predict();
      });
    });

    // Optional: example defaults for quick demo
    window.addEventListener('DOMContentLoaded', () => {
      const v = document.getElementById('visits');
      const a = document.getElementById('amount');
      if (!v.value) v.value = 8;
      if (!a.value) a.value = 120;
    });
  </script>
</body>
</html>
